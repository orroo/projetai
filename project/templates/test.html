{% load static %}
{% include "css.html" %}

 <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--light-bg);
            color: #333;
            line-height: 1.6;
        }
        
        .form-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }
        
        .form-title {
            color: var(--secondary-color);
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }
        
        .form-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        fieldset {
            margin-bottom: 2rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 1.5rem;
            background: #fff;
            transition: all 0.3s ease;
        }
        
        fieldset:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        legend {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary-color);
            padding: 0 1rem;
            background: white;
            border-radius: 20px;
            border: 1px solid #e0e0e0;
            width: auto;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        .form-control, .form-select {
            border-radius: 6px;
            border: 1px solid #ced4da;
            padding: 0.75rem 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .input-group-text {
            background-color: #f8f9fa;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-warning {
            background-color: #f39c12;
        }
        
        .btn-group {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .required-field::after {
            content: " *";
            color: var(--accent-color);
        }
        
        .section-icon {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .form-container {
                padding: 1rem;
            }
            
            fieldset {
                padding: 1rem;
            }
        }
        
        /* Floating labels for better UX */
        .form-floating label {
            color: #6c757d;
        }
        
        /* Validation styles */
        .is-invalid {
            border-color: var(--accent-color);
        }
        
        .invalid-feedback {
            color: var(--accent-color);
            font-size: 0.875rem;
        }
        
        /* Animated submit button */
        .btn-submit {
            position: relative;
            overflow: hidden;
        }
        
        .btn-submit:after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn-submit:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .prediction-container {
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
}

.prediction-item {
    transition: all 0.3s ease;
}

.prediction-item:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

.badge {
    font-weight: 500;
    letter-spacing: 0.5px;
    min-width: 120px;
    text-align: center;
}


select {
    min-height: 3rem;
}
    </style>
     {% include "header.html" %}
   
<body>
    <section class="banner_area">
        <div class="banner_inner d-flex align-items-center">
          <div class="container">
            <div
            class="banner_content d-md-flex justify-content-between align-items-center"
            >
            <div class="mb-3 mb-md-0">
                <h2>Dialysis Session</h2>
    
            </div>
            <div class="page_link">
                <a href="{% url 'index' %}">Home</a>
                <a href="{% url 'contact' %}">About Us</a>
            </div>
        </div>
    </div>
  </div>
  </section>
  <!--================End Home Banner Area =================-->


    <div class="form-container">
        <h1 class="form-title">
            <i class="fas fa-heartbeat section-icon"></i>Dialysis Session Data Entry
        </h1>
        
        <form id="dialysisForm" class="needs-validation" novalidate>
            <!-- Patient Info Section -->
            <fieldset class="mb-4">
                <legend><i class="fas fa-user-circle section-icon"></i>Patient Information</legend>
                
                <div class="row g-3" >
                     <div class="col-md-3">
                       <select id="gender" name="gender" class="form-select"  required>
                            <option value="" selected disabled>Select gender</option>
                            <option value="1">Male</option>
                            <option value="0">Female</option>
                        </select>
                        <label for="gender" class="form-label required-field">Gender</label>
                        <!-- <div class="form-group">
                            <label for="gender" class="form-label required-field">Gender</label>
                            <select id="gender" name="gender" class="form-select" required>
                                <option value="" selected disabled>Select gender</option>
                                <option value="1">Male</option>
                                <option value="0">Female</option>
                            </select>
                        </div> -->
                        <!-- </div> -->

                        <div class="invalid-feedback">Please select patient's gender</div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="birthday" name="birthday" 
                                   placeholder="Birth Year" min="1900" max="{% now 'Y' %}" required>
                            <label for="birthday">Birth Year</label>
                            <div class="invalid-feedback">Please enter a valid birth year</div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-floating">
                            <input type="date" class="form-control" id="first_dialysis" name="first_dialysis" required>
                            <label for="first_dialysis">First Dialysis Date</label>
                            <div class="invalid-feedback">Please enter first dialysis date</div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="age" name="age" 
                                   placeholder="Age" min="1" max="120" required>
                            <label for="age">Age</label>
                            <div class="invalid-feedback">Please enter a valid age</div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Session Timing Section -->
            <fieldset class="mb-4">
                <legend><i class="far fa-clock section-icon"></i>Session Timing</legend>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="datetime-local" class="form-control" id="keyindate" name="keyindate" required>
                            <label for="keyindate">Key In Date/Time</label>
                            <div class="invalid-feedback">Please enter key in date and time</div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="datetime-local" class="form-control" id="dialysisstart" name="dialysisstart" required>
                            <label for="dialysisstart">Dialysis Start Time</label>
                            <div class="invalid-feedback">Please enter dialysis start time</div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Vitals Section -->
            <fieldset class="mb-4">
                <legend><i class="fas fa-heartbeat section-icon"></i>Vital Signs</legend>
                
                <div class="row g-3 mb-3">
                    <!-- Blood Pressure -->
                    <div class="col-md-4">
                        <label for="sbp" class="form-label">Systolic BP (mmHg)</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="sbp" name="sbp" placeholder="120">
                            <span class="input-group-text">mmHg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="dbp" class="form-label">Diastolic BP (mmHg)</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="dbp" name="dbp" placeholder="80">
                            <span class="input-group-text">mmHg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="temperature" class="form-label">Temperature (°C)</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="temperature" name="temperature" placeholder="36.6">
                            <span class="input-group-text">°C</span>
                        </div>
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <!-- Pulse and Respiration -->
                    <div class="col-md-4">
                        <label for="pulse" class="form-label">Pulse Rate (bpm)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="pulse" name="pulse" placeholder="72">
                            <span class="input-group-text">bpm</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="respiratory_rate" class="form-label">Respiratory Rate</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="respiratory_rate" name="respiratory_rate" placeholder="16">
                            <span class="input-group-text">breaths/min</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="blood_oxygen_lvl" class="form-label">Oxygen Saturation</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="blood_oxygen_lvl" name="blood_oxygen_lvl" placeholder="98.0" min="0" max="100">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <!-- Other vitals -->
                    <div class="col-md-4">
                        <label for="glucose_lvl" class="form-label">Glucose Level</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="glucose_lvl" name="glucose_lvl" placeholder="5.5">
                            <span class="input-group-text">mmol/L</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="hypotension" class="form-label">Hypotension</label>
                        <select id="hypotension" name="hypotension" class="form-select">
                            <option value="" selected disabled>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="DM" class="form-label">Diabetes Mellitus</label>
                        <select id="DM" name="DM" class="form-select">
                            <option value="" selected disabled>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
                
                <div class="row g-3">
                    <!-- Dialysis parameters -->
                    <div class="col-md-4">
                        <label for="conductivity" class="form-label">Conductivity</label>
                        <input type="number" step="0.1" class="form-control" id="conductivity" name="conductivity">
                    </div>
                    
                    <div class="col-md-4">
                        <label for="uf" class="form-label">Ultrafiltration</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="uf" name="uf">
                            <span class="input-group-text">L</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="blood_flow" class="form-label">Blood Flow Rate</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="blood_flow" name="blood_flow">
                            <span class="input-group-text">mL/min</span>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Weights Section -->
            <fieldset class="mb-4">
                <legend><i class="fas fa-weight section-icon"></i>Weight Measurements</legend>
                
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="weightstart" class="form-label">Pre-Dialysis Weight</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="weightstart" name="weightstart">
                            <span class="input-group-text">kg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="weightend" class="form-label">Post-Dialysis Weight</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="weightend" name="weightend">
                            <span class="input-group-text">kg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="dryweight" class="form-label">Dry Weight</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="dryweight" name="dryweight">
                            <span class="input-group-text">kg</span>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Machine Settings Section -->
            <fieldset class="mb-4">
                <legend><i class="fas fa-cogs section-icon"></i>Machine Settings</legend>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label for="dialyzer" class="form-label">Dialyzer Type</label>
                        <input type="text" class="form-control" id="dialyzer" name="dialyzer">
                    </div>
                    
                    <div class="col-md-4">
                        <label for="bath" class="form-label">Dialysate Bath</label>
                        <input type="text" class="form-control" id="bath" name="bath">
                    </div>
                    
                    <div class="col-md-4">
                        <label for="technique" class="form-label">Technique</label>
                        <input type="text" class="form-control" id="technique" name="technique">
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label for="gain" class="form-label">Gain</label>
                        <input type="number" step="0.1" class="form-control" id="gain" name="gain">
                    </div>
                    
                    <div class="col-md-4">
                        <label for="bath_temperature" class="form-label">Bath Temperature</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="bath_temperature" name="bath_temperature">
                            <span class="input-group-text">°C</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="replacement_Volume" class="form-label">Replacement Volume</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="replacement_Volume" name="replacement_Volume">
                            <span class="input-group-text">L</span>
                        </div>
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label for="kt" class="form-label">Kt/V</label>
                        <input type="number" step="0.1" class="form-control" id="kt" name="kt">
                    </div>
                    
                    <div class="col-md-4">
                        <label for="Bath_Flow" class="form-label">Dialysate Flow Rate</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="Bath_Flow" name="Bath_Flow">
                            <span class="input-group-text">mL/min</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="bicarbonate_conductivity" class="form-label">Bicarbonate Conductivity</label>
                        <input type="number" step="0.1" class="form-control" id="bicarbonate_conductivity" name="bicarbonate_conductivity">
                    </div>
                </div>
                
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="arterial_Pressure" class="form-label">Arterial Pressure</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="arterial_Pressure" name="arterial_Pressure">
                            <span class="input-group-text">mmHg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="Venous_Pressure" class="form-label">Venous Pressure</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="Venous_Pressure" name="Venous_Pressure">
                            <span class="input-group-text">mmHg</span>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <label for="transmembrane_Pressure" class="form-label">Transmembrane Pressure</label>
                        <div class="input-group">
                            <input type="number" step="0.1" class="form-control" id="transmembrane_Pressure" name="transmembrane_Pressure">
                            <span class="input-group-text">mmHg</span>
                        </div>
                    </div>
                </div>
            </fieldset>

           <!-- Form Actions -->
<!-- <div class="d-flex justify-content-center mt-5">
    <button type="submit" class="btn btn-primary btn-lg btn-submit px-3 mx-4">
        <i class="fas fa-save me-2"></i>Predict 
    </button>
    <button id="refresh" type="reset" class="btn btn-secondary btn-lg px-3 mx-4">
        <i class="fas fa-redo me-2"></i>Reset Form
    </button>
    <button id="notify-btn" type="button" class="btn btn-warning btn-lg px-3 mx-4">
        <i class="fas fa-bell me-2"></i>Notifications
    </button> -->


    <!-- Form Actions -->
<div class="d-flex justify-content-center mt-5 gap-3 flex-wrap">
    <!-- Predict Button -->
    <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm d-flex align-items-center">
        <i class="fas fa-save me-2"></i> Predict
    </button>

    <!-- Reset Button -->
    <button id="refresh" type="reset" class="btn btn-outline-secondary btn-lg px-5 rounded-pill shadow-sm d-flex align-items-center">
        <i class="fas fa-redo me-2"></i> Reset Form
    </button>

    <!-- Notifications Button -->
    <button id="notify-btn" type="button" class="btn btn-danger btn-lg px-5 rounded-pill shadow-sm d-flex align-items-center text-white">
        <i class="fas fa-bell me-2"></i> Notifications
    </button>
</div>

        </form>
<div class="prediction-container mt-5 p-4 bg-light rounded-3 shadow-sm border">
    <h2 class="text-center mb-4" style="font-size: 1.6rem;">
        <i class="fas fa-chart-line me-2"></i>Live Prediction Results
    </h2>
    
    <div class="prediction-results">
        <!-- Predicted Duration -->
        <div class="prediction-item p-3 mb-3 bg-white rounded-3 border">
            <div class="d-flex justify-content-between align-items-center">
                <strong class="fs-5">
                    <i class="fas fa-clock me-2 text-primary"></i>Predicted Duration:
                </strong>
                <span id="duration" class="badge bg-primary rounded-pill px-3 py-2" style="font-size: 1rem; min-width: 110px;">Calculating...</span>
            </div>
        </div>

        <!-- Predicted Frequency -->
        <div class="prediction-item p-3 bg-white rounded-3 border">
            <div class="d-flex justify-content-between align-items-center">
                <strong class="fs-5">
                    <i class="fas fa-wave-square me-2 text-primary"></i>Predicted Frequency:
                </strong>
                <span id="frequency" class="badge bg-primary rounded-pill px-3 py-2" style="font-size: 1rem; min-width: 110px;">Calculating...</span>
            </div>
        </div>
    </div>
</div>

        <!-- <div class="prediction-container mt-4 p-4 bg-light rounded-3 shadow-sm border">
    <h2 class="text-center mb-4">
        <i class="fas fa-chart-line me-2"></i>Live Prediction Results
    </h2>
    
    <div class="prediction-results">
        <div class="prediction-item p-3 mb-3 bg-white rounded-3 border">
            <div class="d-flex justify-content-between align-items-center">
                <strong class="fs-5">
                    <i class="fas fa-clock me-2 text-primary"></i>Predicted Duration:
                </strong>
                <span id="duration" class="badge bg-primary rounded-pill fs-6 px-3 py-2">Calculating...</span>
            </div>
        </div>
        
        <div class="prediction-item p-3 bg-white rounded-3 border">
            <div class="d-flex justify-content-between align-items-center">
                <strong class="fs-5">
                    <i class="fas fa-wave-square me-2 text-primary"></i>Predicted Frequency:
                </strong>
                <span id="frequency" class="badge bg-primary rounded-pill fs-6 px-3 py-2">Calculating...</span>
            </div>
        </div>
    </div>
</div> -->
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Form Validation Script -->
    <script>
        (function() {
            'use strict';
            
            // Fetch the form we want to apply validation to
            var form = document.getElementById('dialysisForm');
            
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                form.classList.add('was-validated');
            }, false);
            
            // Real-time validation for birth year
            document.getElementById('birthday').addEventListener('input', function() {
                var currentYear = new Date().getFullYear();
                if (this.value < 1900 || this.value > currentYear) {
                    this.setCustomValidity('Please enter a valid year between 1900 and ' + currentYear);
                } else {
                    this.setCustomValidity('');
                }
            });
            
            // Calculate age based on birth year
            document.getElementById('birthday').addEventListener('change', function() {
                if (this.value) {
                    var currentYear = new Date().getFullYear();
                    var age = currentYear - parseInt(this.value);
                    document.getElementById('age').value = age;
                }
            });
        })();
    </script>
</body>
</html>




    <script>
        let socket = new WebSocket(getWebSocketUrl()+"/ws/predict/");

        socket.onopen = function(e) {
            console.log("WebSocket connected");

        };


        document.getElementById("dialysisForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const formObj = {};
            formData.forEach((value, key) => formObj[key] = value);

            socket.send(JSON.stringify({ input: formObj }));
        });

        document.getElementById("refresh").addEventListener("click", function(e) {
            socket.close()
            socket = new WebSocket(getWebSocketUrl()+"/ws/predict/");

            socket.onclose = function(event) {
                console.log("WebSocket connection closed.");
            };
            
            socket.onopen = function(e) {
            console.log("WebSocket connected");

        };

           socket.onmessage = function(event) {
            console.log('msg received')
            const data = JSON.parse(event.data);
            console.log(data);
            minutes =Math.round(data.duration);
            if (!isNaN(minutes)) {
                const hours = minutes / 60;
                const rest_minutes = minutes % 60;

                document.getElementById("duration").textContent =  `${minutes} minutes = ${hours.toFixed(0)} hours and ${rest_minutes.toFixed(0)} minutes`;
                // document.getElementById('result').textContent = 
            } else {
                document.getElementById('duration').textContent = "error ?";
            }
            // document.getElementById("duration").textContent =  Math.round(data.duration);
            document.getElementById("frequency").textContent = Math.round(data.frequency*100)/100;
        };
        });


        socket.onmessage = function(event) {
            console.log('msg received')
            const data = JSON.parse(event.data);
            console.log(data);
            minutes =Math.round(data.duration);
            if (!isNaN(minutes)) {
                const hours = minutes / 60;
                const rest_minutes = minutes % 60;

                document.getElementById("duration").textContent =  `${minutes} minutes = ${hours.toFixed(0)} hours and ${rest_minutes.toFixed(0)} minutes`;
                // document.getElementById('result').textContent = 
            } else {
                document.getElementById('duration').textContent = "error ?";
            }
            // document.getElementById("duration").textContent =  Math.round(data.duration);
            document.getElementById("frequency").textContent = Math.round(data.frequency*100)/100;
        };

        socket.onclose = function(event) {
            console.log("WebSocket connection closed.");
        };






        let socket3 = new WebSocket(getWebSocketUrl()+"/ws/upload/");

        
        socket3.onopen = function(e) {
            console.log("WebSocket connected");
            message = 'hello'
            socket3.send(JSON.stringify({ message: message }));
        
            
        };


        document.getElementById("refresh").addEventListener("click", function(e) {
            socket3.close()
            socket3 = new WebSocket(getWebSocketUrl()+"/ws/upload/");

            socket3.onclose = function(event) {
                console.log("WebSocket connection closed.");
            };

            socket3.onopen = function(e) {
                console.log("WebSocket connected");
                message = 'hello'
                socket3.send(JSON.stringify({ message: message }));
        
            
            };


            socket3.onmessage = function(event) {
            console.log('msg received')
            const msgdata = JSON.parse(event.data);
            const data = msgdata.message[0];
            console.log(data)

            console.log(data.datatime);
            console.log(data.sbp);
            console.log(data.dbp);
            console.log(data.temperature);
            console.log(data.conductivity);
            console.log(data.uf);
            console.log(data.blood_flow);
            console.log(data.gender);
            console.log(data.birthday);
            console.log(new Date(data.first_dialysis));

            document.getElementById("first_dialysis").value = new Date(data.first_dialysis).toISOString().slice(0, 10) ;
            document.getElementById("keyindate").value = new Date(data.keyindate).toISOString().slice(0, 16) ;

            var d = new Date();
            d.setHours(data.dialysisstart.slice(0,2));
            d.setMinutes(data.dialysisstart.slice(3,5));
            console.log(d);
            console.log(data.dialysisstart.slice(0,2));
            console.log(data.dialysisstart.slice(3,5));
            

            document.getElementById("dialysisstart").value = d.toISOString().slice(0, 16) ;
            document.getElementById ("sbp").value = data.sbp;
            document.getElementById("dbp").value = data.dbp;
            document.getElementById("temperature").value = data.temperature;
            document.getElementById("conductivity").value = data.conductivity;
            document.getElementById("uf").value = data.uf;
            document.getElementById("blood_flow").value = data.blood_flow;
            if (data.gender == 2) {
            document.getElementById("gender").selectIndex = 2;
            }
            else  {
            document.getElementById("gender").selectIndex = 1;
            }



            document.getElementById("birthday").value = data.birthday;
            document.getElementById("DM").value = data.DM;
            document.getElementById("weightstart").value = data.weightstart;
            document.getElementById("weightend").value = data.weightend;
            document.getElementById("dryweight").value = data.dryweight;
            document.getElementById("pulse").value = data.pulse;
            document.getElementById("respiratory_rate").value = data.respiratory_rate;
            document.getElementById("blood_oxygen_lvl").value = data.blood_oxygen_lvl;
            document.getElementById("glucose_lvl").value = data.glucose_lvl;
            if (data.hypotension == "NO") {
            document.getElementById("hypotension").value = 0;
            }
            else  {
            document.getElementById("hypotension").value = 1;
            }

            document.getElementById("age").value = data.age;
            document.getElementById("dialyzer").value = data.dialyzer;
            document.getElementById("bath").value = data.bath;
            document.getElementById("technique").value = data.technique;
            document.getElementById("gain").value = data.gain;
            document.getElementById("bath_temperature").value = data.bath_temperature;
            document.getElementById("replacement_Volume").value = data.replacement_Volume;
            document.getElementById("kt").value = data.kt;
            document.getElementById("Bath_Flow").value = data.Bath_Flow;
            document.getElementById("bicarbonate_conductivity").value = data.bicarbonate_conductivity;
            document.getElementById("arterial_Pressure").value = data.arterial_Pressure;
            document.getElementById("Venous_Pressure").value = data.Venous_Pressure;
            document.getElementById("transmembrane_Pressure").value = data.transmembrane_Pressure;
            
        };
        });


        socket3.onmessage = function(event) {
            console.log('msg received')
            const msgdata = JSON.parse(event.data);
            const data = msgdata.message[0];
            console.log(data)


            document.getElementById("first_dialysis").value = new Date(data.first_dialysis).toISOString().slice(0, 10) ;
            document.getElementById("keyindate").value = new Date(data.keyindate).toISOString().slice(0, 16) ;

            var d = new Date();
            d.setHours(data.dialysisstart.slice(0,2));
            d.setMinutes(data.dialysisstart.slice(3,5));
            console.log(d);
            console.log(data.dialysisstart.slice(0,2));
            console.log(data.dialysisstart.slice(3,5));
            

            document.getElementById("dialysisstart").value = d.toISOString().slice(0, 16) ;
            document.getElementById ("sbp").value = data.sbp;
            document.getElementById("dbp").value = data.dbp;
            document.getElementById("temperature").value = data.temperature;
            document.getElementById("conductivity").value = data.conductivity;
            document.getElementById("uf").value =  Math.round(data.uf*10)/10;
            document.getElementById("blood_flow").value = data.blood_flow;
            if (data.gender == 2) {
            document.getElementById("gender").value = 0;
            }
            else  {
            document.getElementById("gender").value = 1;
            }



            document.getElementById("birthday").value = data.birthday;
            document.getElementById("DM").value = data.DM;

// /*************  ✨ Windsurf Command ⭐  *************/
// document.getElementById("rounded_value").value = Math.round(data.someNumber);

// /*******  e30da7fb-1795-4813-9e1d-e6df5044b174  *******/
            document.getElementById("weightstart").value = Math.round(data.weightstart*10)/10;
            document.getElementById("weightend").value =  Math.round(data.weightend*10)/10;
            document.getElementById("dryweight").value = data.dryweight;
            document.getElementById("pulse").value = data.pulse;
            document.getElementById("respiratory_rate").value = data.respiratory_rate;
            document.getElementById("blood_oxygen_lvl").value = data.blood_oxygen_lvl;
            document.getElementById("glucose_lvl").value = data.glucose_lvl;
            if (data.hypotension == "NO") {
            document.getElementById("hypotension").value = 0;
            }
            else  {
            document.getElementById("hypotension").value = 1;
            }

            document.getElementById("age").value = data.age;
            document.getElementById("dialyzer").value = data.dialyzer;
            document.getElementById("bath").value = data.bath;
            document.getElementById("technique").value = data.technique;
            document.getElementById("gain").value = data.gain;
            document.getElementById("bath_temperature").value = data.bath_temperature;
            document.getElementById("replacement_Volume").value = Math.round(data.replacement_Volume*10)/10;
            document.getElementById("kt").value = data.kt;
            document.getElementById("Bath_Flow").value = data.Bath_Flow;
            document.getElementById("bicarbonate_conductivity").value = data.bicarbonate_conductivity;
            document.getElementById("arterial_Pressure").value = data.arterial_Pressure;
            document.getElementById("Venous_Pressure").value = data.Venous_Pressure;
            document.getElementById("transmembrane_Pressure").value = data.transmembrane_Pressure;
            
        };

        socket3.onclose = function(event) {
            console.log("WebSocket connection closed.");
        };




    </script>
<!-- 
    <h1>Live Prediction</h1>
    <p><strong>Predicted Duration:</strong> <span id="duration">Waiting...</span></p>
    <p><strong>Predicted Frequency:</strong> <span id="frequency">Waiting...</span></p -->


        

    {% include "brands.html" %}
    {% include "footer.html" %}